---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.3
  name: gateways.services.platform.opendatahub.io
spec:
  group: services.platform.opendatahub.io
  names:
    kind: Gateway
    listKind: GatewayList
    plural: gateways
    singular: gateway
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - description: Ready
      jsonPath: .status.conditions[?(@.type=="Ready")].status
      name: Ready
      type: string
    - description: Authentication Mode
      jsonPath: .status.detectedAuthMode
      name: Auth Mode
      type: string
    - description: Gateway Resource Ready
      jsonPath: .status.gatewayResourceStatus.gatewayReady
      name: Gateway Ready
      type: string
    - description: Age
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          Gateway is the Schema for the gateways API
          Manages a single Gateway API-based ingress with centralized authentication
          for all OpenDataHub components, replacing multiple OpenShift Routes
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: GatewaySpec defines the desired state of Gateway
            properties:
              auth:
                description: |-
                  Auth configuration for gateway authentication handling
                  Determines how the gateway will authenticate users (auto-detect vs manual)
                properties:
                  forceMode:
                    description: |-
                      Manual override for authentication mode
                      Only used when Mode is "manual"
                      Values: "IntegratedOAuth" | "OIDC" | "None"
                    type: string
                  mode:
                    description: |-
                      Authentication mode: "auto" (default) | "manual"
                      "auto" - detect from cluster configuration
                      "manual" - use explicit ForceMode setting
                    type: string
                  oidc:
                    description: |-
                      OIDC configuration (required when ForceMode="OIDC" or auto-detected OIDC)
                      Contains external OIDC provider details for kube-auth-proxy configuration
                    properties:
                      audiences:
                        description: |-
                          Additional audiences for token validation
                          Used for multi-tenant or multi-application scenarios
                        items:
                          type: string
                        type: array
                      clientSecretRef:
                        description: |-
                          Reference to secret containing clientID and clientSecret
                          Secret must be in the same namespace as the Gateway resource
                        properties:
                          key:
                            description: The key of the secret to select from.  Must
                              be a valid secret key.
                            type: string
                          name:
                            default: ""
                            description: |-
                              Name of the referent.
                              This field is effectively required, but due to backwards compatibility is
                              allowed to be empty. Instances of this type with an empty value here are
                              almost certainly wrong.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            type: string
                          optional:
                            description: Specify whether the Secret or its key must
                              be defined
                            type: boolean
                        required:
                        - key
                        type: object
                        x-kubernetes-map-type: atomic
                      issuerURL:
                        description: OIDC issuer URL for external provider
                        type: string
                    required:
                    - clientSecretRef
                    - issuerURL
                    type: object
                  waitForRollout:
                    description: |-
                      Wait for OIDC rollout completion before deploying gateway components
                      Prevents authentication failures during cluster authentication transitions
                    type: boolean
                type: object
              certificates:
                description: |-
                  Certificate configuration for TLS termination
                  Supports user-provided certificates or integration with existing certificate hooks
                properties:
                  secretRef:
                    description: |-
                      Reference to user-provided certificate secret (when Type="provided")
                      Secret must contain tls.crt and tls.key
                    properties:
                      key:
                        description: The key of the secret to select from.  Must be
                          a valid secret key.
                        type: string
                      name:
                        default: ""
                        description: |-
                          Name of the referent.
                          This field is effectively required, but due to backwards compatibility is
                          allowed to be empty. Instances of this type with an empty value here are
                          almost certainly wrong.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                        type: string
                      optional:
                        description: Specify whether the Secret or its key must be
                          defined
                        type: boolean
                    required:
                    - key
                    type: object
                    x-kubernetes-map-type: atomic
                  type:
                    description: |-
                      Type of certificate management: "auto" | "provided" | "cert-manager"
                      "auto" - use OpenShift auto-generated certificates
                      "provided" - use user-provided certificate secret
                      "cert-manager" - integrate with cert-manager for automatic renewal
                    type: string
                type: object
              domain:
                description: |-
                  Domain configuration for the gateway
                  The base domain for all gateway routes (e.g., "odh.example.com")
                type: string
              rollout:
                description: |-
                  Rollout configuration for managing authentication mode transitions
                  Controls behavior during OIDC rollouts and authentication mode changes
                properties:
                  rolloutCheckInterval:
                    description: |-
                      Interval for checking OIDC rollout status
                      Default: 30 seconds
                    type: string
                  rolloutTimeout:
                    description: |-
                      Maximum time to wait for OIDC rollout completion
                      Default: 10 minutes
                    type: string
                type: object
            type: object
          status:
            description: GatewayStatus defines the observed state of Gateway
            properties:
              authProxyStatus:
                description: |-
                  Authentication proxy status
                  Status of the deployed kube-auth-proxy instance
                properties:
                  configuredMode:
                    description: Currently configured authentication mode in the proxy
                    type: string
                  ready:
                    description: Deployment readiness status
                    type: boolean
                  serviceEndpoint:
                    description: Proxy service endpoint
                    type: string
                  tlsReady:
                    description: TLS certificate status for auth proxy
                    type: boolean
                required:
                - ready
                - tlsReady
                type: object
              conditions:
                items:
                  properties:
                    lastHeartbeatTime:
                      description: |-
                        The last time we got an update on a given condition, this should not be set and is
                        present only for backward compatibility reasons
                      format: date-time
                      type: string
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.
                        If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: message is a human-readable message indicating
                        details about the transition.
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration
                        is 9, the condition is out of date with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        The value should be a CamelCase string.
                      type: string
                    severity:
                      description: |-
                        Severity with which to treat failures of this type of condition.
                        When this is not specified, it defaults to Error.
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-type: atomic
              detectedAuthMode:
                description: |-
                  Currently detected authentication mode from cluster analysis
                  Values: "IntegratedOAuth" | "OIDC" | "None" | "Unknown"
                type: string
              gatewayResourceStatus:
                description: |-
                  Gateway API resources status
                  Tracks the status of created GatewayClass and Gateway resources
                properties:
                  gatewayAddress:
                    description: |-
                      Assigned gateway hostname/address
                      Populated once the Gateway resource gets an address
                    type: string
                  gatewayClassReady:
                    description: GatewayClass resource status
                    type: boolean
                  gatewayReady:
                    description: Gateway resource status
                    type: boolean
                  httpRoutes:
                    description: List of HTTPRoute resources created for components
                    items:
                      description: HTTPRouteStatus tracks individual component HTTPRoute
                        status
                      properties:
                        component:
                          description: Component name (e.g., "dashboard", "kserve")
                          type: string
                        name:
                          description: HTTPRoute resource name
                          type: string
                        path:
                          description: Route path prefix (e.g., "/dashboard")
                          type: string
                        ready:
                          description: HTTPRoute readiness status
                          type: boolean
                      required:
                      - component
                      - name
                      - ready
                      type: object
                    type: array
                required:
                - gatewayClassReady
                - gatewayReady
                type: object
              observedGeneration:
                description: The generation observed by the resource controller.
                format: int64
                type: integer
              oidcRolloutStatus:
                description: |-
                  OIDC rollout status (when applicable)
                  Tracks the progress of OIDC configuration rollout across control plane nodes
                properties:
                  activeRevisions:
                    description: |-
                      List of active control plane node revisions
                      Used to verify consistent OIDC configuration deployment
                    items:
                      format: int32
                      type: integer
                    type: array
                  complete:
                    description: Whether OIDC rollout is complete across all control
                      plane nodes
                    type: boolean
                  message:
                    description: Human-readable message about rollout status
                    type: string
                  phase:
                    description: 'Current rollout phase: "Detecting" | "InProgress"
                      | "Complete" | "Failed"'
                    type: string
                  startTime:
                    description: Timestamp when rollout monitoring started
                    format: date-time
                    type: string
                required:
                - complete
                type: object
              phase:
                type: string
            type: object
        type: object
        x-kubernetes-validations:
        - message: Gateway name must be gateway
          rule: self.metadata.name == 'gateway'
    served: true
    storage: true
    subresources:
      status: {}
